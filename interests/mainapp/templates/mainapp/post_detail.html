{% extends 'mainapp/base.html' %}
{% load staticfiles %}
{% load emoji_tags %}
{% load hitcount_tags %}
{% block content %}
<div class="post">
        
  <p>Posted by <a href="{% url 'mainapp:view_profile_with_pk' pk=post.author.pk %}"><strong>{{ post.author|safe|linebreaksbr|truncatechars_html:50 }}</strong></a>{% if post.author.userprofileinfo.verified %} <img draggable="false" title="Verified User" class="verifed" src="{% static 'images\verified.png' %}" alt="verified" width="15" height="15" srcset=""> {% endif %}{% if post.author.userprofileinfo.moderator %}<span title="Moderator" id="moderator">[M]</span>{% endif %} {% if post.published_date == 0 %}just now {% else %}{{ post.published_date|timesince }} ago {% endif%} {% if post.group %}in <a href="#">{{ post.group.name }}</a>{% endif %}</p>
  <br>
  {% if hitcount.total_hits >= 50 %}
  <p title="This post has gained over 50 views, meaning it is trending" id="trending"><i class="fas fa-fire"></i> {{ hitcount.total_hits }} Views</p>
  {% else %}
  <p>{{ hitcount.total_hits }} Views</p>
  {% endif %}
        <br><hr id="divider_post"><br>
        {% if object.author == user %}
          <div>
            <a class="update" href="{% url 'mainapp:post-update' object.id %}">Update</a>
            <a class="delete" href="{% url 'mainapp:post-delete' object.id %}">Delete</a>
          </div>
        {% endif %}<br>
        <h1><a title="{{ post.title }}" class="title" href="#">{{ post.title }}</a></h1>
        <!-- <h1 class="title" title="View {{ post.title }}">{{ post.title }}</h1> -->
        <br>
        {% if post.image %}
        {% if post.NSFW %}
        <img class="post-image-nsfw myImg" src="{{ post.image.url }}" alt="pfp" width="20%" height="20%" draggable="false"><br><br><br>
          {% else %}
          <img id="myImg" src="{{ post.image.url }}" alt="{{ post.image.url }}" style="width:100%;max-width:300px"><br><br><br>
          {% endif %}
          

        {% endif %}
        {% if post.file %}
          <!-- <video width="500px" height="500px" controls>
            <source src="{{ post.file.url }}" type="video/mp4">
       </video> -->
       <video id='my-video' class='video-js' controls preload='auto' width='640' height='264' data-setup='{}'>
    <source src='{{ post.file.url }}' type='video/mp4'>
    <p class='vjs-no-js'>
      To view this video please enable JavaScript, and consider upgrading to a web browser that
      <a href='https://videojs.com/html5-video-support/' target='_blank'>supports HTML5 video</a>
    </p>
  </video>
          {% endif %}
          <div class="post-text">
        {{ post.text|safe|linebreaksbr }}
</div>
        <br>
        <form method="post">
          {% csrf_token %}
          <a class="btn" href="{% url 'mainapp:postpreference' post.id %}">Like {{ post.likes }}</a>
      </form>
        <div class="tags-list-detail">
            
              
        {% for tag in post.tags.all|slice:"0:5" %}
        <a class="tag-list-a" href="{% url 'mainapp:tagged' tag.slug %}" class="tag-list-box"><button class="tag-list-style">{{ tag.name|safe|truncatechars_html:10 }}</button></a>&nbsp;&nbsp;
        <!-- <p id="tags-test">{{ tag.name|linebreaksbr }}</p>&nbsp;&nbsp; -->
        {% empty %}
        <li>No tags</li>
        {% endfor %}
        
        </div>

        <!-- The Modal -->
        
<div id="myModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="img01">
    <div id="caption"></div>
  </div>
  
  
  
    <br>
    <a class="comment" title="View all {{ post.approve_comments.count }} comments" href="{% url 'mainapp:post_detail' pk=post.pk %}">Comments: {{ post.approve_comments.count }}</a>
</div>
</div><br>
        

      
        
    <div class="divider"></div><br>
    <div class="if-comments">
    </div>
    
    <form class="post-form" method="POST" action="{% url 'mainapp:add_comment_to_post' pk=post.pk %}">
      {% csrf_token %}
      {{form.as_p}}
      <button type="submit" class="commentbtn"><a class="aclass" href="#"></a>Comment</button>
  </form>
 
<br><br>
  <div class="container">

    
        <h3>Comments: {{ post.approve_comments.count }}</h3><br> <!--Style this up later, it's looking a bit meh atm-->
  {% for comment in post.comments.all %}
  
  {% if user.is_authenticated or comment.approved_comment %}
  <p>Posted by <a href="{% url 'mainapp:view_profile_with_pk' pk=comment.author.pk %}"><strong></a> {{ comment.author }}</strong> {{ comment.created_date|timesince }} ago</p> 
  <p id="comment-text">{{ comment.text|safe|linebreaks }}</p>
  <a href="{% url 'mainapp:add_reply_to_comment' pk=comment.pk %}"><p>Reply</p></a>
  <p></p>
{% endif %}

{% for reply in comment.replies.all %}
<li class="reply-li">
<ul class="reply-ul">
      <p>(REPLY) | Posted by <strong>{{ reply.author }}</strong> {{ reply.created_date|timesince }} ago</p> 
      <p id="reply-text">{{ reply.text|safe|linebreaks }}</p>
      <p>{{ reply.created_date|timesince }} ago</p><br>
      </ul>
      </li>
      {% endfor %}
  {% empty %}
      <p>No comments posted.</p>
  {% endfor %}
  
  
</div>
    

<script>
    // Get the modal
    var modal = document.getElementById("myModal");
    
    // Get the image and insert it inside the modal - use its "alt" text as a caption
    var img = document.getElementById("myImg");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    img.onclick = function(){
      modal.style.display = "block";
      modalImg.src = this.src;
      captionText.innerHTML = this.alt;
    }
    
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() { 
      modal.style.display = "none";
    }
    </script>
{% endblock %}