{% extends 'mainapp/base.html' %}
{% load staticfiles %}
{% load emoji_tags %}
{% block content %}
<div class="post">
        
        <p>Posted by <a href="{% url 'mainapp:user-posts' post.author.username %}"><strong>{{ post.author }}</strong></a>{% if post.author.is_superuser %} <img draggable="false" title="Verified User" class="verifed" src="{% static 'images\verified.png' %}" alt="verified" width="15" height="15" srcset=""> {% endif %} {{ post.published_date|timesince }} ago</p>
        <br><hr id="divider_post"><br>
        {% if object.author == user %}
          <div>
            <a class="update" href="{% url 'mainapp:post-update' object.id %}">Update</a>
            <a class="delete" href="{% url 'mainapp:post-delete' object.id %}">Delete</a>
          </div>
        {% endif %}<br>
        <h1><a title="View {{ post.title }}" class="title" href="{% url 'mainapp:post_detail' pk=post.pk %}">{{ post.title }}</a></h1>
        <br>
        {% if post.image %}
        {% if post.NSFW %}
        <img class="post-image-nsfw myImg" src="{{ post.image.url }}" alt="pfp" width="20%" height="20%" draggable="false"><br><br><br>
          {% else %}
          <img id="myImg" src="{{ post.image.url }}" alt="{{ post.image.url }}" style="width:100%;max-width:300px"><br><br><br>
          {% endif %}
          {% if post.file %}
          <video src="{{ post.file }}">
          Your browser doesn't support video :(
          </video>
      
          {% endif %}

        {% endif %}
        {{ post.text|safe|linebreaksbr }}
        <br>
        <p>Tags</p><br>
        <div class="tags-list-detail">
        {% for tag in post.tags.all %}
        <li class="tag-list-box"><a class="tag-list-style" href="{% url 'mainapp:tagged' tag.slug %}">{{ tag.name }}</a></li>&nbsp;&nbsp;
        {% empty %}
        <li>No tags</li>
        {% endfor %}
        
        </div>

        <!-- The Modal -->
        
<div id="myModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="img01">
    <div id="caption"></div>
  </div>
  
  
  
    <br>
    <a class="comment" title="View all {{ post.approve_comments.count }} comments" href="{% url 'mainapp:post_detail' pk=post.pk %}">Comments: {{ post.approve_comments.count }}</a>
</div>
</div><br>
        

      
        
    <div class="divider"></div><br>
    <div class="if-comments">
    </div>
 <button class="commentbtn"><a class="aclass" href="{% url 'mainapp:add_comment_to_post' pk=post.pk %}">Add comment</a></button>
 
<br><br>
  <div class="container">

    
        <h3>Comments: {{ post.approve_comments.count }}</h3><br> <!--Style this up later, it's looking a bit meh atm-->
  {% for comment in post.comments.all %}
  
  {% if user.is_authenticated or comment.approved_comment %}
  <p>Posted by: <strong>{{ comment.author }}</strong></p> 
  <p id="comment-text">{{ comment.text|safe|linebreaks }}</p>
  <p>{{ comment.created_date|timesince }} ago</p><br>
  {% if not comment.approved_comment %}
      <a class="remove-btn" href="{% url 'mainapp:comment_remove' pk=comment.pk %}"><span class="fa fa-remove"></span></a>
      <a class="remove-btn" href="{% url 'mainapp:comment_approve' pk=comment.pk %}"><span class="fa fa-check"></span></a>
  {% endif %}
  
  
 


{% endif %}
  {% empty %}
      <p>No comments posted.</p>
  {% endfor %}
  
</div>
    

<script>
    // Get the modal
    var modal = document.getElementById("myModal");
    
    // Get the image and insert it inside the modal - use its "alt" text as a caption
    var img = document.getElementById("myImg");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    img.onclick = function(){
      modal.style.display = "block";
      modalImg.src = this.src;
      captionText.innerHTML = this.alt;
    }
    
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() { 
      modal.style.display = "none";
    }
    </script>
{% endblock %}